<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auksjonsdata H친ndtering</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

    <h1>Auksjonsdata-Scraperen 游뿣 </h1>

    <!-- Scraping-logg-knapp (Deaktiveres n친r scraping starter) -->
    <div style="margin-top: 20px; text-align: center;">
        <a href="/scraping-log" class="btn" id="log-button">Scraping-logg</a>
        <p id="warning-message" style="color: red; display: none;">丘멆잺 Stopp scraperen f칮r du ser loggen.</p>
    </div>

    <h2> Parametre: </h2>
    <div class="content-container">

                <!-- Lastesymbol (spinner) -->
                <div id="loadingSpinner" class="spinner-overlay" style="display: none;">
                    <div class="spinner"></div>
                </div>
        
        <!-- Skjema-seksjon -->
        <div class="form-container">
            <form action="/" method="post" onsubmit="showLoading()">
                <label for="max_auctions">Antall auksjoner (blank for alle):</label>
                <input type="text" id="max_auctions" name="max_auctions" placeholder="Antall auksjoner">
                
                <label for="max_items_per_auction">Antall objekter per auksjon (blank for alle):</label>
                <input type="text" id="max_items_per_auction" name="max_items_per_auction" placeholder="Antall objekter per auksjon">
          
                <label for="search_term">Filtrer etter ord i objekt-kolonnen (valgfritt):</label>
                <input type="text" id="search_term" name="search_term" placeholder="F.eks. speciedaler">
          
                <label for="search_term_year">Filtrer etter ord i 친rs-kolonnen (valgfritt):</label>
                <input type="text" id="search_term_year" name="search_term_year" placeholder="F.eks. 1980">
          
                <button type="submit" id="submitButton">Start Skraping</button>
                <button type="submit" id="stopButton" formaction="/stop" style="display:none;">Stopp Scraping</button>
            </form>
        </div>

        
        
        <!-- Loading-melding-seksjon -->
        <div class="loading-container">
            <div id="loadingMessage" style="display:none;"></div>
        </div>
    </div>

    <script>
        let scrapingActive = {{ scraping_active | default(false) | tojson }};

        document.addEventListener("DOMContentLoaded", function() {
            let logButton = document.getElementById("log-button");
            let warningMessage = document.getElementById("warning-message");
            let stopButton = document.getElementById("stopButton");

            if (stopButton) {
                stopButton.style.display = 'none';  // Skjuler stoppknappen ved innlasting
            }

            if (scrapingActive) {
                disableLogButton(); // S칮rger for at knappen er deaktivert ved sidenavigering
            }

            logButton.addEventListener("click", function(event) {
                if (scrapingActive) {
                    event.preventDefault();  // Stopper lenken fra 친 친pne
                    warningMessage.style.display = "block";  // Viser advarsel
                }
            });
        });

        function showLoading() {
            disableLogButton(); // Deaktiver knappen umiddelbart ved start

            document.getElementById("loadingSpinner").style.display = "block";

            var auctions = document.getElementById('max_auctions') ? document.getElementById('max_auctions').value : 'alle';
            var items = document.getElementById('max_items_per_auction') ? document.getElementById('max_items_per_auction').value : 'alle';
            var searchTerm = document.getElementById('search_term') ? document.getElementById('search_term').value : 'ingen';
            var searchYear = document.getElementById('search_term_year') ? document.getElementById('search_term_year').value : 'ingen';

            var loadingMessage = 
                                "<br>" +
                                "<div><strong>Scraperen jobber med 친 hente data for f칮lgende parametre: </strong></div>" +
                                "<br>" +
                                "<div><strong>Antall auksjoner:</strong> " + auctions + "</div>" +
                                "<div><strong>Antall objekter per auksjon:</strong> " + items + "</div>" +
                                "<div><strong>Valgt ord i objekt-kolonnen:</strong> " + searchTerm + "</div>" +
                                "<div><strong>Valgt 친r/ord i 친rs-kolonnen:</strong> " + searchYear + "</div>";

            var loadingMessageElement = document.getElementById('loadingMessage');
            if (loadingMessageElement) {
                loadingMessageElement.innerHTML = loadingMessage;
                loadingMessageElement.style.display = 'block';
            }

            var submitButton = document.getElementById('submitButton');
            if (submitButton) {
                submitButton.disabled = true;
            }

            var stopButton = document.getElementById('stopButton');
            if (stopButton) {
                stopButton.style.display = 'block';
            }
        }

        function disableLogButton() {
            let logButton = document.getElementById("log-button");
            let warningMessage = document.getElementById("warning-message");

            if (logButton) {
                logButton.style.pointerEvents = "none";  // Gj칮r knappen ukikkbar
                logButton.style.opacity = "0.5";  // Visuelt deaktivert
            }

            if (warningMessage) {
                warningMessage.style.display = "none";  // Skjuler advarsel til 친 begynne med
            }
        }
    </script>

</body>
</html>
